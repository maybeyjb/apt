# 212：内存马

普通的webshell的马比较容易查杀，被蓝队发现，所以引入内存马。PHP,Java,Python,ASPX等

内存马：无文件webshell。

 写php  内存马      类似金刚狼，删了又可以自己恢复。  蓝队就是结束进程，在删除。用php写的程序一直占用进程，执行写文件的功能，所以就算删除他也会重新生成一个。

![image-20250101205747508](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525460.png)

aspx-----.net文件：（推荐蚁剑）工具植入，传统webshell文件上传后一删除，就连接不上目标了。冰鞋和哥斯拉对aspx的内存马植入不合适，哥斯拉植入后没法利用，冰鞋是有的网页解析不了上传的aspx内存马。所以推荐蚁剑，先引入插件as-exploit，蚁剑后门还在另一个目录下存着。

###### 哥斯拉：

<img src="https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525461.png" alt="image-20250101211024678" style="zoom: 67%;" />

拿到后植入内存马后不知道如何利用，succesfully后没有利用的了：

![image-20250101211332421](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525462.png)

###### 冰蝎

冰蝎，这里因为对两个aspx和asp后门解析不了，所以拿不到webshell：

![image-20250101213825315](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525463.png)

反正冰蝎这里是这样注入内存马，但是冰蝎并不擅长内存马，aspx的内存马植入：

![image-20250101213652404](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525464.png)

###### 蚁剑

蚁剑连接目标，用下载的蚁剑上的插件植入内存马，植入后在目标机上的目录下是没有植入的内存马，植入的是程序，不在磁盘上。---------需要As-Exploits的插件。

![image-20250101214848214](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525465.png)

这里需注意，蚁剑的后门在AwesomeScript-master目录里存着：

![image-20250101215553585](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525466.png)

连接：

![image-20250101215804254](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525467.png)

用As插件后可以查看当前已经植入的内存马和植入内存马：

![image-20250101220136172](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525468.png)

植入内存马：

![image-20250101220254458](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525469.png)

![image-20250101220629659](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525470.png)

内存马测试连接,因为是用aspx拿的webshell，所以内存马的尾缀也为aspx：

![image-20250101221234883](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525471.png)

然后这里目标磁盘上也没有写入的xdsec   的webshell文件：

![image-20250101221904218](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525472.png)

##### java靶场

 搭建java环境：

搭建失败，所以无法显示下来的：

![image-20250104193229976](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525473.png)

演示，哥斯拉植入java内存马，蚁剑还可以看是否被植入内存马。

哥斯拉先上传后门拿到shell后再植入内存马，然后通过内存马路径成功连接：

![image-20250104200440633](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525474.png)

查看对应的目录：

![image-20250104200732867](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525475.png)

![image-20250104201321019](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525476.png)

###### 2

这里蚁剑也可以：和上面演示一样

![image-20250104201904125](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525477.png)

###### 工具

（路径、密码）                  那么这里的，刚开始上传的后门就容易被发现，所以考虑能不能直接植入内存马，

所以就考虑直接植入内存马  generator （jMG-gui-obf-1.0.8.jar）   可以生成许多工具的内存马    生成内存马，这里连接时候注意和内存马的生成时候配置信息要对应，然后用Webshell工具一连接就触发内存马了（内存马就不见了）

生成内存马文件：

![image-20250104202907113](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525478.png)

因为里面是有混淆加密过的：

![image-20250104203002824](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525479.png)

将生成的内存马文件上传到目标目录下、连接内存马，这里就算发现内存马文件，然后删除文件还是可以连接上：

![image-20250104203755200](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525480.png)

 哥斯拉小翻车          当然，这款工具生成的时候肯定是中间件框架要和目标对应。

当前环境应该是不支持linsten监听器：

**![image-20250104204427397](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525481.png)**

换成Filter监听器就支持：

![image-20250104204531549](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525482.png)

python 网站-----植入python内存马，写入py代码执行命令。

![image-20250104205308368](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525483.png)

![image-20250104205802940](https://cdn.jsdelivr.net/gh/maybeyjb/blue-team/img/202506161525484.png)

shiro梭哈工具上也有植入内存马的功能。

内存马学习资料。
